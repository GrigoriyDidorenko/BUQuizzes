$(document).ready(function() {
    jQuery.ajax({
        type: "GET",
        url: 'http://localhost:8080/guest/oneTimeTests',
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        success: function (json) {
            var mail;
            $( "#email" )
                .keyup(function() {
                    var value = $( this ).val();
                    mail=value;
                })
                .keyup();
            var nick;
            $( "#nickname" )
            .keyup(function() {
                    var val = $( this ).val();
                    nick=val;
                })
                .keyup();
            var name;
            $( "#name" )
                .keyup(function() {
                    var valu = $( this ).val();
                    name=valu;
                })
                .keyup();
            var rols = json;
            var mas = [];
            $('select').material_select(
                $.each(rols, function (index, rolsone) {
                    var uniqu = true;
                    for (var i = 0; i < mas.length; i++) {
                        if (mas[i] == rolsone.categoryTestName) {
                            uniqu = false;
                        }
                    }
                    if (uniqu) {
                        mas.push(rolsone.categoryTestName)
                        $('select').append('<option value="' + rolsone.categoryTestName + '">' + rolsone.categoryTestName + '</option>')
                    }
                }))

                    $( "select" ).change(function() {
                        $("#testTable").empty();
                        var str = "";
                        $("#roles option:selected").each(function () {
                            str += $(this).text() + " ";
                        });
                        $.each(rols, function (index, rolsone) {
                            if ($.trim(str) == rolsone.categoryTestName) {
                                var loc = '/pages/openTests/testpage.html?testId=' + rolsone.id + '&email=' + mail + '&nickName=' + nick + '&name='+name;
                                $("#testTable").append("<tr><td><a href='" + loc + "'>" + rolsone.testName + "</a></td><td>" + rolsone.duration + " хв" + "</td><td><input class='submit save-btn-test' type='submit' value='Розпочати'></td></tr>");
                                //TODO
                                $().ready(function () {
                                    // validate the comment form when it is submitted
                                    $("#commentForm").validate({
                                        submitHandler: function () {
                                            window.location.href = loc;
                                        }
                                    });
                                });
                            }
                        });

                    });
        }
    });
});
